var SM=window.SM||{};if(typeof module==="object"&&module.exports){module.exports=SM}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.Object={create:function(e){function t(){}t.prototype=e;return new t},hasKeys:function(e,t){var i=t.length,n=0;for(;n<i;n++){if(!(t[n]in e)){throw new Error('key "'+t[n]+'" is missing')}}},toArray:function(e){var t=[],i;for(i in e){t.push(e[i])}return t},equals:function(e,t){var i;if(e===t){return true}if(!(e instanceof Object)||!(t instanceof Object)){return false}if(e.constructor!==t.constructor){return false}for(i in e){if(!e.hasOwnProperty(i)){continue}if(!t.hasOwnProperty(i)){return false}if(e[i]===t[i]){continue}if(typeof e[i]!=="object"){return false}if(!SM.Object.equals(e[i],t[i])){return false}}for(i in t){if(t.hasOwnProperty(i)&&!e.hasOwnProperty(i)){return false}}return true}};if(window.Object.create){SM.Object.create=window.Object.create}if(typeof module==="object"&&module.exports){module.exports=SM.Object}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.Array={indexOf:function(e,t){var i,n=e.length;for(i=0;i<n;i++){if(e[i]===t){return i}}return-1},getValue:function(e,t){if(t<0){t=0}else if(t>=e.length){t=e.length-1}return e[t]},sortAscending:function(e,t){var i,n;if(typeof e==="string"){i=e.toLowerCase();n=t.toLowerCase();if(i<n){return 1}else if(i>n){return-1}return 0}return e-t},sortDescending:function(e,t){var i,n;if(typeof e==="string"){i=e.toLowerCase();n=t.toLowerCase();if(i<n){return-1}else if(i>n){return 1}return 0}return t-e},unique:function(e){var t={},i,n,s,o=e.length,a=[];for(i=0;i<o;i++){n=e[i];t[n]=n}for(s in t){a.push(t[s])}return a},addUnique:function(e,t){var i=this.indexOf(e,t);if(i===-1){e.push(t)}},removeItem:function(e,t){var i=this.indexOf(e,t);if(i!==-1){e.splice(i,1)}}};if(typeof module==="object"&&module.exports){module.exports=SM.Array}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.String={r_http_url:/^(https?:\/\/)/,init:function(){this.rtrim=/\S/.test("\xa0")?/^[\s\xA0]+|[\s\xA0]+$/g:/^\s+|\s+$/g},truncate:function(e,t,i){if(!e){return""}if(!t){return e}if(i===undefined){i=true}if(e.length>t){if(i){return e.substring(0,t-3)+"..."}return e.substring(0,t)}return e},endsWith:function(e,t){if(!e||e.length<t.length){return false}return e.substr(e.length-t.length)===t},beginsWith:function(e,t){if(!e||e.length<t.length){return false}return e.substr(0,t.length)===t},afterLast:function(e,t){var i;if(!e){return""}i=e.lastIndexOf(t);if(i===-1){return""}return e.substr(i+1)},beforeFirst:function(e,t){var i;if(!e){return""}i=e.indexOf(t);if(i===-1){return e}return e.substr(0,i)},isHttpUrl:function(e){return this.r_http_url.test(e)},trim:function(){if(String.prototype.trim){return function(e){if(e===null){return""}return String.prototype.trim.call(e)}}return function(e){return e===null?"":e.toString().replace(this.rtrim,"")}}()};SM.String.init();if(typeof module==="object"&&module.exports){module.exports=SM.String}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.Math={roundTo:function(e,t){return this._roundTo(e,t,0)},roundPercentageTo:function(e,t){return this._roundTo(e,t,2)},isInt:function(e){if(!isFinite(e)||(typeof e).toLowerCase()!=="number"){return false}return Math.floor(e)===e},toPercentString:function(e,t){if(!isFinite(e)){return"0%"}return""+this.roundPercentageTo(e,t)+"%"},_roundTo:function(e,t,i){var n,s;if(isNaN(e)){return 0}if(e===0){return 0}if(t===undefined){t=1}n=Math.pow(10,t+i)*e;s=Math.pow(10,t);return Math.round(n)/s}};if(typeof module==="object"&&module.exports){module.exports=SM.Math}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM");require("./array")}SM.DOM={SPACE:" ",getClass:function(e){return e.className?e.className:""},hasClass:function(e,t){var i,n,s=0,o;if(!e){return false}i=this.getClass(e).split(this.SPACE);n=t.split(this.SPACE);o=n.length;for(;s<o;s++){if(SM.Array.indexOf(i,n[s])!==-1){return true}}return false},removeClass:function(e,t){var i=this.getClass(e).split(this.SPACE),n;if(!e||!t){return}n=SM.Array.indexOf(i,t);if(n!==-1){i.splice(n,1);e.className=i.join(this.SPACE)}},contains:function(e,t){var i=t;while(i){if(i===e){return true}i=i.parentNode}return false},addClass:function(e,t){if(!e||!t){return}if(!this.hasClass(e,t)){e.className=this.getClass(e)+this.SPACE+t}},walkChildren:function(e,t){var i=0,n=e.childNodes,s=n.length,o;for(;i<s;i++){o=n[i];if(o&&o.nodeType===1){t(o)}}},getElementsByClassName:function(e,t){var i,n,s,o=0,a;t=t||document;if(document.getElementsByClassName){return t.getElementsByClassName(e)}n=[];i=t.all?t.all:t.getElementsByTagName("*");a=i.length;for(;o<a;o++){s=i[o];if(this.hasClass(s,e)){n.push(s)}}return n},getCoordinates:function(e,t){var i=0,n=0;do{n+=e.offsetLeft;i+=e.offsetTop;e=e.offsetParent;if(t&&e===t){break}}while(e);return{top:i,left:n}}};if(typeof module==="object"&&module.exports){module.exports=SM.DOM}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.Event={normalize:function(e){if(e.srcElement){e.target=e.srcElement}if(!e.preventDefault){e.preventDefault=function(){this.returnValue=false}}if(!e.stopPropagation){e.stopPropagation=function(){this.cancelBubble=true}}return e},add:function(e,t,i){var n="on";if(!e){return}function s(e){e=SM.Event.normalize(e);i(e)}if(e.addEventListener){e.addEventListener(t,s,false)}else if(e.attachEvent){e.attachEvent(n+t,s)}else if(e[n+t]){e[n+t]=s}},BLUR:"blur",CHANGE:"change",CLICK:"click",ENTER_KEYPRESS:"enterkeypress",FOCUS:"focus",FOCUSIN:"focusin",FOCUSOUT:"focusout",KEYDOWN:"keydown",KEYPRESS:"keypress",KEYUP:"keyup",MOUSEDOWN:"mousedown",MOUSEENTER:"mouseenter",MOUSELEAVE:"mouseleave",MOUSEMOVE:"mousemove",MOUSEUP:"mouseup",PASTE:"paste",RESIZE:"resize",SUBMIT:"submit"};if(typeof module==="object"&&module.exports){module.exports=SM.Event}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.KeyCodes={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,CAPS:20,ESCAPE:27,SPACE:32,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,AMPERSAND:55,A:65,C:67,V:86,X:88,LEFT_WINDOW:91,RIGHT_WINDOW:92,SELECT:93,LESS_THAN:188,GREATER_THAN:190,COMMAND:224,isNonAdditiveKey:function(e){return e===SM.KeyCodes.BACKSPACE||e===SM.KeyCodes.END||e===SM.KeyCodes.HOME||e===SM.KeyCodes.LEFT||e===SM.KeyCodes.UP||e===SM.KeyCodes.RIGHT||e===SM.KeyCodes.DOWN||e===SM.KeyCodes.DELETE},getEscapedHtmlContentCharLength:function(e){switch(e){case SM.KeyCodes.AMPERSAND:return 5;case SM.KeyCodes.LESS_THAN:case SM.KeyCodes.GREATER_THAN:return 4;default:return undefined}}};if(typeof module==="object"&&module.exports){module.exports=SM.KeyCodes}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM");require("./object")}SM.Object=$.extend(SM.Object,{deepCopy:function(e){return $.extend(true,{},e)},copy:function(e){return $.extend({},e)},update:function(e,t){$.extend(e,t)},deepUpdate:function(){var e=Array.prototype.concat.apply([true],arguments);return $.extend.apply($,e)},extend:function(){var e=Array.prototype.concat.apply([{}],arguments);return $.extend.apply($,e)},deepExtend:function(){var e=Array.prototype.concat.apply([true,{}],arguments);return $.extend.apply($,e)}});if(typeof module==="object"&&module.exports){module.exports=SM.Object}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.PubSub={$document:$(window.document),subscribe:function(e,t,i){if(!this.on){return this}if(e===null||e===undefined){throw new Error("SM.PubSub: subscribing to a null or undefined event")}if(t===undefined||t===null){throw new Error("SM.PubSub: subscribing to "+e+"without a callback")}if(arguments.length===3){this.$document.on(e,i,t)}else{this.$document.on(e,t)}return this},unsubscribe:function(e,t){if(!this.on){return this}if(e===null||e===undefined){throw new Error("SM.PubSub: unsubscribing to a null or undefined event")}if(arguments.length===2){this.$document.off(e,t)}else{this.$document.off(e)}},publish:function(e){var t={};if(!this.on){return this}if(e===null||e===undefined){throw new Error("SM.PubSub: publishing a null or undefined event")}if(typeof e==="string"){t.type=e}else{if(e.type===null||e.type===undefined){throw new Error("SM.PubSub: publishing a null or undefined event")}t=e}this.$document.trigger(t);return this},time:function(e,t,i){var n,s,o=$.Deferred();if(!this.on){return this}if(arguments.length===3){SM.PubSub.subscribe(e,function(){n=(new Date).getTime()},i);SM.PubSub.subscribe(t,function(e){s=(new Date).getTime()-n;o.notify(s,e)},i)}else{SM.PubSub.subscribe(e,function(){n=(new Date).getTime()});SM.PubSub.subscribe(t,function(e){s=(new Date).getTime()-n;o.notify(s,e)})}return o},on:true};if(typeof module==="object"&&module.exports){module.exports=SM.PubSub}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.Widget={__NAME:undefined,__init:undefined,__destroy:undefined,__setters:undefined,__getters:undefined,__counter:0,__defaults:undefined,el:undefined,$el:undefined,__settings:undefined,__uid:undefined,get:function(e,t){var i=this.__getters;if(e===undefined){return undefined}if(i&&i[e]){return i[e](this,t)}return this.__settings[e]},set:function(e,t){var i=this.__setters;if(arguments.length===2){if(i&&i[e]){i[e](this,t)}else{this.__settings[e]=t}}return this},destroy:function(){if(this.__destroy){this.__destroy()}},__$document:$(document),__subscribe:function(e,t,i){if(!i){i={}}if(e===undefined){throw new Error("__subscribe: tried to subscribe to undefined event")}if(t===undefined){throw new Error("__subscribe: subscribing with an undefined callback")}i[this.__NAME]=this;i.self=this;SM.PubSub.subscribe(e+"."+this.__NAME+this.__uid,t,i);return this},__unsubscribe:function(e,t){if(e===undefined){throw new Error("__unsubscribe: tried to unsubscribe to undefined event")}SM.PubSub.unsubscribe(e+"."+this.__NAME+this.__uid,t);return this},__trigger:function(e){var t={};if(e===undefined){throw new Error("__trigger: tried to trigger an undefined event")}if(typeof e==="string"){t.type=this.__NAME+"."+e}else{if(e.type===undefined){throw new Error("__trigger: tried to trigger an undefined event")}t=e;t.type=this.__NAME+"."+e.type}t[this.__NAME]=this;this.$el.trigger(t);return this},subscribe:function(){this.__subscribe.apply(this,arguments);return this},trigger:function(){this.__trigger.apply(this,arguments);return this},unsubscribe:function(){this.__unsubscribe.apply(this,arguments);return this},bind:function(e,t,i){if(arguments.length===2){i=t;if(typeof i!=="function"){throw new Error("bind takes event, delegate, callback or event, callback")}this.$el.on(e,{self:this},i)}else if(arguments.length===3){this.$el.on(e,t,{self:this},i)}else{throw new Error("bind takes event, delegate, callback or event, callback")}return this},__initSettings:function(e){var t,i,n;this.__settings={};if(e){i={};n={};if(this.__defaults){for(t in this.__defaults){if(this.__defaults.hasOwnProperty(t)&&e.hasOwnProperty(t)){n[t]=e[t]}}for(t in e){if(e.hasOwnProperty(t)&&!this.__defaults.hasOwnProperty(t)){i[t]=e[t]}}this.__settings=SM.Object.deepExtend(this.__defaults,n)}else{i=e}SM.Object.update(this.__settings,i)}else if(this.__defaults){this.__settings=SM.Object.deepCopy(this.__defaults)}}};SM.Widgets={register:function(e){e=SM.Object.extend(SM.Widget,e);if(!e.__NAME){throw new Error("the __NAME property must be defined")}e.__counter=0;this._extendjQuery(e);return e},extend:function(e,t){var i=SM.Object.extend(e,t);return this.register(i)},deepExtend:function(e,t){var i=SM.Object.deepExtend(e,t);return this.register(i)},create:function(e,t,i){var n=$.data(t,e.__NAME);if(!n){n=SM.Object.create(e);n.__initSettings(i);n.__uid=e.__counter++;if(e.__counter===1&&e.__setup){e.__setup()}n.el=t;n.$el=$(t);$.data(t,e.__NAME,n);if(i===undefined){i={}}if(e.__init){n.__init(i)}n.$el.on("remove",function(){n.destroy()})}return n},_extendjQuery:function(n){var s=this.create;if($.fn[n.__NAME]){throw new Error("class with this name already exists")}$.fn[n.__NAME]=function(i){function e(e,t){s(n,t,i)}return this.each(e)}}};if(typeof module==="object"&&module.exports){module.exports.Widget=SM.Widget;module.exports.Widgets=SM.Widgets}SM.Touch={TOUCH_BOUNDARY:5,TAP_DELAY:300,_touchCSSEnabled:false,isAndroid:false,init:function(e){this.touchStartCoordinates={x:null,y:null};e.addEventListener("touchstart",this.onTouchStart,false);e.addEventListener("touchend",this.onTouchEnd,false);this.enableTouchSensitiveCSS(e)},isTouchDevice:function(){var e=false;var t=/Chrome\/[.0-9]* Mobile/;if(navigator.userAgent.indexOf("Android")>0){e=/Galaxy Nexus|Nexus/.test(navigator.userAgent);if(t.test(navigator.userAgent)){e=true}}var i=/iP(ad|hone|od)/.test(navigator.userAgent);this.isAndroid=e;return i||e},isIOSDevice:function(){return/iP(ad|hone|od)/.test(navigator.userAgent)},touchHasMoved:function(e){var t=e.originalEvent.changedTouches[0],i=this.TOUCH_BOUNDARY,n=this.touchStartCoordinates.x,s=this.touchStartCoordinates.y;if(Math.abs(t.clientX-n)>i||Math.abs(t.clientY-s)>i){return true}return false},onTouchStart:function(e){var t=e.touches[0],i=SM.Touch,n=$(".datepicker.datepicker-dropdown");i.touchStartCoordinates={x:t.clientX,y:t.clientY};if(n.length){e.stopPropagation()}},onTouchEnd:function(e){var t=SM.Touch;t.touchStartCoordinates={x:null,y:null};t.lastClickTime=e.timeStamp},enableTouchSensitiveCSS:function(e){$(e).on("touchstart",".touch-sensitive",function(e){$(this).addClass("touchdown")}).on("touchmove",".touch-sensitive",function(e){if(SM.Touch.touchHasMoved(e)){var t=this;$(this).addClass("touchdown-animating-out");$(this).removeClass("touchdown");setTimeout(function(){$(t).removeClass("touchdown-animating-out")},250)}}).on("touchend",".touch-sensitive",function(e){var t=this;$(this).addClass("touchdown-animating-out");$(this).removeClass("touchdown");setTimeout(function(){$(t).removeClass("touchdown-animating-out")},250)});if(this.isAndroid){$(e).on("touchcancel",".touch-sensitive",function(e){var t=this;$(this).addClass("touchdown-animating-out");$(this).removeClass("touchdown");setTimeout(function(){$(t).removeClass("touchdown-animating-out")},250)})}}};SM.SliderQuestion=SM.Widgets.register({__NAME:"sliderQuestion",_POPOUT_LENGTH:253,_ZENKAKU:"\uff10\uff11\uff12\uff13\uff14\uff15\uff16\uff17\uff18\uff19",_INPUT_MAX_LEN:8,_CLEAR_BUTTON_WIDTH:50,_defaultSliderConfig:{min:0,max:100,step:1},__init:function(){this._parseElements()._parseConfiguration()._popoutCheck();if(!this._$sliderWidget.data("slider")){this._detectTextOverflow()._initWidget()._events()._syncResponseFromInput()}if(SM.Touch.isTouchDevice()){var e=this.$el.find("[id|=slider]"),t="Double tap and hold or use the alternative input to adjust.";e.attr("aria-label",e.attr("aria-label").concat(t))}},_parseElements:function(){if(!this.$el.hasClass("slider-wrapper")){throw new Error("Slider question failed to initialize.")}this._$sliderWrapper=this.$el.find(".slider-question-wrapper");this._$sliderInput=this.$el.find("input");this._$sliderClear=this.$el.find(".slider-clear");this._$sliderWidget=this._$sliderWrapper.find("[data-slider]");this._$sliderKnob=this._$sliderWidget.find("a");this._$sliderValWarning=this.$el.siblings(".slider-warning");return this},_parseConfiguration:function(){this._min=parseInt(this._$sliderWidget.attr("data-slider-min"),10);this._max=parseInt(this._$sliderWidget.attr("data-slider-max"),10);this._initPos=parseInt(this._$sliderWidget.attr("data-slider-init"),10);this._stepSize=parseInt(this._$sliderWidget.attr("data-slider-step-size"),10);this._questionId=this.$el.closest("[data-question-id]").attr("data-question-id");return this},_popoutCheck:function(){if(this._questionId==="sample_s"){this.$el.parent().addClass("force-mobile");this._isPopout=true}return this},_initWidget:function(){var e=this._initPos!==this._min&&this._initPos!==this._max,t;if(this._isPopout){this._$sliderWidget.width(this._POPOUT_LENGTH);this._$sliderKnob.removeClass("has-response")}this._$sliderWidget.slider({options:{restrictStepSize:false,animateClick:true},constraints:{min:this._min,max:this._max,step:this._stepSize},value:this._initPos!==undefined?this._initPos:this._getMidValue(this._min,this._max)});if(e){t="50%"}else if(this._initPos===this._max){t="100%"}else{t="0"}this.$el.find(".slider-init-bar").css("left",t);this._reset(this);return this},_events:function(){var r=this,e=$("body").hasClass("ie9");this._inputEvent=e?"keyup":"input";this._namespacedResize="resize.slider_"+r._questionId;this._namespacedOrientationchange="orientationchange.slider_"+r._questionId;this.$el.on("slider.change",".slider-question",function(e){r._$sliderKnob.removeClass("dragging");r._handleInput(e,r)}).on("slider.start",".slider-question",function(e){r._$sliderKnob.addClass("has-response");r._handleInput(e,r)}).on("slider.stop",".slider-question",function(e){r._$sliderKnob.removeClass("dragging");r._handleInput(e,r)}).on("slider.slide",".slider-question",function(e){r._$sliderKnob.addClass("dragging");r._updateValue(e)});this._$sliderInput.on("blur",function(e){var t=$(e.target),i=t.val(),n=$.trim(i),s=r._$sliderWidget.data("slider").get("constraints"),o,a;t.val(n);n=r._truncateInput(n);t.val(n);n=r._zenkakuToHankaku(n);if(n===""){r._reset(r)}else if(r._isLegalInput(n)){n=parseInt(n,10);if(s.min<=n&&n<=s.max){a=r._stepSizeAdjustment(n);if(a!==n){n=a;r._adjustedVal=a;r._$sliderValWarning.fadeIn()}else{r._adjustedVal=undefined;r._$sliderValWarning.hide()}if(parseInt(r._$sliderWidget.data("slider").get("value"),10)===n){r._gotResponse(r)}r._$sliderWidget.data("slider").set("value",n);r._$sliderKnob.removeClass("dragging");if(r._adjustedVal!==undefined){t.val(r._adjustedVal)}else{t.val(i)}}else{r._reset(r)}r._$sliderClear.show()}else{r._reset(r);r._$sliderClear.show()}});this._$sliderClear.on("keypress",function(e){if(e.keyCode===13){r._reset(r,true);e.preventDefault();e.stopPropagation()}}).on("click",function(e){r._reset(r,true);e.preventDefault();e.stopPropagation()});r._freeze();if(!r._isPopout){$(window).on(r._namespacedResize+","+r._namespacedOrientationchange,function(e,t){if(t&&t==="scroll"){return}var i=r.$el.closest("[data-question-id]").attr("data-question-id"),n=$(".survey-page-body").find("[data-question-id="+i+"]");if(n.length>0){r._updateSliderConfig(r)}else{r._freeze()}})}return this},_syncResponseFromInput:function(){var e=$.trim(this._$sliderInput.val());if(e){if(this._isLegalInput(e)&&this._min<=e&&this._max>=e){e=parseInt(e,10);this._$sliderWidget.data("slider").set("value",e);this._$sliderKnob.removeClass("dragging").addClass("has-response")}this._$sliderClear.show()}return this},_detectTextOverflow:function(){var e;this._$sliderClear.css("opacity",0).show();e=this._$sliderClear[0].scrollWidth;this._$sliderClear.hide().css("opacity",1);if(e>this._CLEAR_BUTTON_WIDTH){this.$el.addClass("slider-clear-overflow")}return this},_getMidValue:function(e,t){return Math.floor(e+(t-e)/2)},_handleInput:function(e,t){this._gotResponse(t);this._updateValue(e)},_updateValue:function(e){var t=$(e.target),i=t.find("a"),n=e.value,s=e.slider.get("value"),o=n!==undefined?n:s,a=$.find("html.auto-scroll").length==1;if((n!==undefined||e.namespace==="start")&&i.hasClass("has-response")){t.closest(".slider-wrapper").find("input").val(o);i.attr("aria-valuenow",o)}if(a){var r=t.closest(".question-row").find("button.new-button");if(r.length>0){r.removeClass("hide")}}},_updateSliderConfig:function(e){var t=e._$sliderKnob.hasClass("has-response"),i=e._$sliderWidget.data("slider").get("constraints");e._$sliderWidget.data("slider").set("constraints",i);if(!t){e._reset(e)}},_gotResponse:function(e){e._$sliderKnob.addClass("has-response");e._$sliderClear.show()},_onResponseCleared:function(e){e._$sliderKnob.removeClass("has-response");e._$sliderValWarning.hide();if($.trim(e._$sliderInput.val())===""){e._$sliderClear.hide()}},_reset:function(e,t){var i=e._$sliderWidget.data("slider").get("constraints"),n=e._$sliderInput.val();if(e._initPos>this._min&e._initPos<this._max){e._$sliderKnob.css("left",e._$sliderWidget.width()/2+"px")}else{e._$sliderWidget.data("slider").set("value",this._initPos)}if(t){e._$sliderInput.val("");e._$sliderClear.blur();e._$sliderInput.focus()}else{e._$sliderInput.val(n)}e._onResponseCleared(e);e._$sliderKnob.removeClass("has-response dragging")},_isLegalInput:function(e){return e.indexOf(".")===-1&&!isNaN(parseInt(e,10))},_freeze:function(){$(window).off(this._namespacedResize+" "+this._namespacedOrientationchange)},_stepSizeAdjustment:function(e){var t=(this._max-this._min)%this._stepSize,i=Math.ceil((this._max-this._min)/this._stepSize),n=Math.floor((e-this._min)/this._stepSize),s=Math.round((e-this._min)/this._stepSize),o=(e-this._min)%this._stepSize,a;if(o>0&&t!==0){if(n===i-1){if(o<t/2){s=n}else{s=i}}}if(s<i){a=s*this._stepSize+this._min}else{a=this._max}return a},_truncateInput:function(e){if(e.length>this._INPUT_MAX_LEN){return e.substr(0,this._INPUT_MAX_LEN)}return e},_zenkakuToHankaku:function(e){var t=e,i=0,n;for(i;i<this._ZENKAKU.length;i++){n=new RegExp(this._ZENKAKU[i],"g");t=t.replace(n,i+"")}return t},deactivate:function(){this._freeze();$(window).off(this._inputEvent);this._$sliderClear.find("a").off("keypress").off("click");this._$sliderWidget.removeData("slider")},get:function(e){if(e==="value"){return this._$sliderInput.val()}}});SM.CheckBox=SM.Widgets.register({__NAME:"checkbox",__init:function(){var e=this.$el.find("input[type=checkbox]");this.$el.on("focusin","input[type=checkbox]",{self:this},this._onFocusin).on("focusout","input[type=checkbox]",{self:this},this._onFocusout);if(SM.Touch.isTouchDevice()){this.$el.on("touchend","label",{self:this},this._onTouchEnd);this.$el.closest("td").on("touchend",{self:this},this._onTouchEnd);this.$el.on("click","input[type=checkbox]",{self:this},this._onClick);this.$el.on("changeOtherAnswerText","input[type=checkbox]",{self:this},this._onChange)}else{this.$el.on("change","input[type=checkbox]",{self:this},this._onChange)}this._setCheckedClass(e)},_onFocusin:function(e){var t=e.data.self,i=$(this),n=t._getLabel(i);n.addClass("focus")},_onFocusout:function(e){var t=e.data.self,i=$(this),n=t._getLabel(i);n.removeClass("focus")},_onChange:function(e){var t=e.data.self,i=$(this);t._setCheckedClass(i)},_onClick:function(e){if(!SM.Touch.isIOSDevice()){var t=e.data.self,i=t.$el.find("input[type=checkbox]");t._setCheckedClass(i)}else{return false}},_onTouchEnd:function(e){var t=e.data.self,i=t.$el.find("input[type=checkbox]"),n=t._getLabel(i),s=n.hasClass("checked"),o=i.attr("data-other-answer")!==undefined&&i.attr("data-other-answer")!==false,a=o?t.$el.parent().find("[data-other-text]"):null;if(e.isDefaultPrevented()||typeof n.closest("[data-preset-question]")[0]!=="undefined"||e.target.tagName.toLowerCase()==="a"){return}if(e.cancelable){e.preventDefault()}if(!SM.Touch.touchHasMoved(e)){i.prop("checked",!s);t._setCheckedClass(i);if(!o){i.focus()}else{a.focus()}}},_getLabel:function(e){var t=e.attr("id");return this.$el.find("[for="+t+"]")},_setCheckedClass:function(i){var e=this,t=this._getLabel(i),n=$.find("html.auto-scroll").length==1,s=-1,o=i.parents("[data-question-id]").attr("data-question-id"),a={row:i.parents("[row]").attr("row"),col:i.parents("[col]").attr("col"),checked:i.prop("checked"),question:e};this.$el.parents("[id|=question-field]").find("input[type=checkbox]").each(function(e,t){if(i.val()===$(t).val()){s=e}});SM.ResponseQuality._updateQuestion(o,s,a);if(i.prop("checked")){t.addClass("checked")}else{t.removeClass("checked")}if(n){var r=i.closest(".question-row").find("button.new-button"),l=i.closest(".question-row").find("input:checked").length;if(r.length>0&&l>0){r.removeClass("hide")}}}});SM.Dropdown=SM.Widgets.register({__NAME:"dropdown",__init:function(){var e=this.$el;if(this.$el.attr("id")==="survey-language-selector"){this.$el.on("change",this._onLanguageChange)}else{this.$el.on("change",null,{self:this},this._onChange)}},_onChange:function(e){var t=$(this),i=t.closest("div.question-row"),n=i.find("button.new-button"),s=$.find("article.auto-scroll").length==1,o=t.prop("selectedIndex"),a=t.parents("[data-question-id]").attr("data-question-id"),r={row:t.parents("[row]").attr("row"),col:t.parents("[col]").attr("col"),question:t};SM.ResponseQuality._updateQuestion(a,o,r);if(s&&!t.find("option[data-other-answer]").prop("selected")&&i.find("div[data-question-type=matrix_menu]").length===0&&i.find("div[data-question-type^=datetime]").length===0){SM.SurveyPageForm.switchToNextQuestion(t);setTimeout(function(){n.addClass("hide")},100)}else if(n.length>0){n.removeClass("hide")}},_onLanguageChange:function(){var e=$(this),t=$('form[name="surveyForm"]'),i=$("input#is_changing_language",t);var n=e.val();t.attr("action",n);i.val("true");t.submit()}});SM.RadioButtonGroup=SM.Widgets.register({__NAME:"radioButtonGroup",__init:function(){var e=this;this.$el.on("focusin","input[type=radio]",{self:this},this._onFocusin).on("focusout","input[type=radio]",{self:this},this._onFocusout).on("change","input[type=radio]",{self:this},this._onChange);if(SM.Touch.isTouchDevice()){this.$el.on("touchend","td:has(label), label",{self:this},this._onTouchEnd)}else{this.$el.on("click","label[data-sm-radio-button-label].checked",{self:this},this._onClick).on("click","td:has(label)",{self:this},this._onCellClick)}this._setCheckedClass(true)},_onFocusin:function(e){var t=e.data.self,i=$(this),n=t._getLabel(i);n.addClass("focus")},_onFocusout:function(e){var t=e.data.self,i=$(this),n=t._getLabel(i);n.removeClass("focus")},_onChange:function(e){var t=e.data.self;t._setCheckedClass();$naRadio=t.$el.find("[data-emoji-na-button] .radio-button-input");if($naRadio.length==1&&$(e.target).is($naRadio)){$currentQuestion=$naRadio.closest(".question-emoji-rating-table");if($currentQuestion.length){$currentQuestion.find(".emoji-rating").removeClass("selected");$currentQuestion.find(".emoji-border").removeClass("hovered");$currentQuestion.find(".emoji-rating input[type=radio]").prop("checked",false).data("selected",false)}}},_onTouchEnd:function(e){var t=$(this).closest("[data-sm-radio-button]");if(e.isDefaultPrevented()||typeof t.closest("[data-preset-question]")[0]!=="undefined"||e.target.tagName.toLowerCase()==="a"){return}if(e.cancelable){e.preventDefault()}if(!t.length){t=$(this).find("[data-sm-radio-button]")}var i=e.data.self,n=t.find("input[type=radio]"),s=i._getLabel(n),o=i.$el.find(".checked"),a=n.attr("data-other-answer")!==undefined&&n.attr("data-other-answer")!==false;if(!SM.Touch.touchHasMoved(e)){if(o.length){o.find("input[type=radio]").prop("checked",false)}n.prop("checked",!s.hasClass("checked"));n.trigger("change");if(!a){n.focus()}}},_onCellClick:function(e){if($(e.target).is("td")){$(this).find("label").click()}},_onClick:function(e){var t=e.data.self,i=$(this),n=i.attr("for"),s=$("#"+n);if(s.prop("checked")&&typeof s.closest("[data-preset-question]")[0]==="undefined"){s.prop("checked",false);s.trigger("change");e.preventDefault()}},_getLabel:function(e){var t=e.attr("id");return this.$el.find("[for="+t+"]")},_setCheckedClass:function(c){var h=this,f,_=-1,p=-1,g=$.find("html.auto-scroll").length==1;this.$el.find("input[type=radio]").each(function(e,t){var i=$(this),n=h._getLabel(i);if(n.hasClass("checked")){p=e;n.addClass("unselected")}else{n.removeClass("unselected")}n.removeClass("checked");i.attr("aria-checked","false");if(i.prop("checked")){n.addClass("checked");i.attr("aria-checked","true");f=i;_=e;if(g&&!c){var s=i.closest("div.question-row"),o=s.find("button.new-button"),a=s.find('table.question-matrix-table:not(".question-emoji-rating-table")').length==1,r=i.attr("data-other-answer")!==undefined&&i.attr("data-other-answer")!==false,l=s.find("input[type=radio][data-other-answer]").length>0,u=s.find("input[data-other-text]").length>0||s.find("textarea[data-other-text]").length>0,d=a||r||u&&!l;if(!d){SM.SurveyPageForm.switchToNextQuestion(i)}else{if(o.length>0){showButton=s.find("input:checked").length;if(showButton>0){o.removeClass("hide")}}}}}});if(_!==-1||p!==-1){var e=-1;if(_===-1){e=p}else{e=_}var t=$(this.$el.find("input[type=radio]")[e]);var i={row:t.parents("[row]").attr("row"),col:t.parents("[col]").attr("col"),checked:t.prop("checked"),question:h};var n=t.parents("[data-question-id]").attr("data-question-id");SM.ResponseQuality._updateQuestion(n,e,i)}if(SM.Touch.isTouchDevice()){this.$el.trigger({type:"radiobuttonchanged",$selected:f})}}});SM.OtherAnswerTextOption=SM.Widgets.register({__NAME:"otherAnswerTextOption",__init:function(e){e=typeof e==="string"?e:"question";var t=this.$el.parents("."+e),i=t.find("[data-other-answer]");if(i.length){this._$answer=i;this._answerTag=i.prop("tagName").toLowerCase();if(this._answerTag==="option"){t.find("select").on("change",{self:this},this._onSelectChange);this._toggleVisibility()}else{i.on("change",{self:this},this._onOtherInputChange)}this.$el.on("keyup paste",{self:this},this._onEdit).on("click touchend",{self:this},this._onClickOrTouch)}},_onEdit:function(e){var t=e.data.self,i=$.trim(t.$el.val());if(!i){return}if(e.type==="keyup"&&e.which===SM.KeyCodes.TAB||e.which===SM.KeyCodes.SHIFT){return}if(t._answerTag==="option"){if(!t._$answer.prop("selected")){t._$answer.prop("selected",true)}}else{if(!t._$answer.prop("checked")){t._$answer.prop("checked",true);t._$answer.trigger("change");t._$answer.trigger("changeOtherAnswerText")}}},_toggleVisibility:function(){var e=!!this._$answer.prop("selected"),t=$(this.el.parentElement),i=$(this.el);t.toggle(e);i.trigger("positionCurrencySymbol");return e},_onSelectChange:function(e){var t=e.data.self;var i=t._toggleVisibility();if(i){t.$el.focus()}},_onOtherInputChange:function(e){var t=e.data.self;if(t._$answer.prop("checked")){t.$el.focus()}},_onClickOrTouch:function(e){var t=e.data.self;if(t._answerTag==="option"){if(!t._$answer.prop("selected")){t._$answer.prop("selected",true)}}else{if(!t._$answer.prop("checked")){t._$answer.prop("checked",true);t._$answer.trigger("change");t._$answer.trigger("changeOtherAnswerText")}}}});SM.ForcedRankingQuestion=SM.Widgets.register({__NAME:"forcedRankingQuestion",__init:function(){this.$el.on("change","input[type=radio]",{self:this},this._onRadioChange)},_onRadioChange:function(e){var t=e.data.self,i,n,s,o,a;i=$(this);if(!i.prop("checked")){return}o=t.$el.find("table tbody tr");n=i.parents("tr");s=n.find("input[type=radio]");a=s.index(i);o.not(n).each(function(){var e=$(this),t=e.find("input[type=radio]"),i=t.eq(a);if(i.prop("checked")){i.prop("checked",false);i.trigger("change")}})}});SM.NpsQuestion=SM.Widgets.register({__NAME:"npsQuestion",NPS_CONTAINER_OFFSET_TOP:7,NPS_CONTAINER_OFFSET_LEFT:8,NPS_POP_UP_PADDING:20,__init:function(){var e=this;if(SM.Touch.isTouchDevice()){this.$el.on("touchstart","label",{self:this},this._onTouchStart).on("touchend","label",{self:this},this._onTouchEnd).on("radiobuttonchanged",{self:this},this._setNpsPressedState);this.$el.find(".radio-button-display").attr("aria-hidden","true")}},_onTouchStart:function(e){var t=e.data.self,i=$(this),n=i.closest(".nps-radio-button-container"),s=n.parents("div.question-matrix-nps-table").find(".nps-pop-up");s.css({width:n.outerWidth()+t.NPS_POP_UP_PADDING,height:n.outerHeight()+t.NPS_POP_UP_PADDING});s.show();s.find(".nps-pop-up-text").text(n.find(".radio-button-display").attr("data-position"));s.offset({top:n.offset().top-t.NPS_CONTAINER_OFFSET_TOP,left:n.offset().left-t.NPS_CONTAINER_OFFSET_LEFT})},_onTouchEnd:function(e){var t=e.data.self,i=$(this).closest(".nps-radio-button-container"),n=i.parents("div.question-matrix-nps-table").find(".nps-pop-up");n.hide()},_setNpsPressedState:function(e){var t=e.data.self;t.$el.find(".nps-radio-button-container").removeClass("nps-pressed-state");if(e.$selected){e.$selected.closest(".nps-radio-button-container").addClass("nps-pressed-state")}}});SM.RankingQuestion=SM.Widgets.register({__NAME:"rankingQuestion",NA_CLASS:"question-ranking-na-rank",NA_LABEL_CLASS:"answer-label-rank-na",NA_LABEL_SELECTOR:".answer-label-rank-na",CHECKBOX_SELECTOR:"input[type=checkbox]",SORTING_CLASS:"question-ranking-sorting",SORTING_PLACEHOLDER_CLASS:"question-ranking-sort-placeholder",SORTING_PLACEHOLDER_SELECTOR:".question-ranking-sort-placeholder",DISABLED_SORTABLE_CLASS:"disable-sortable",DISABLED_SORTABLE_HANDLE_CLASS:"disable-sortable-handle",HANDLE_HOVER_CLASS:"question-ranking-rank-hover",SORTABLE_SELECTOR:".question-ranking-rank-wrapper",DISABLED_SORTABLE_SELECTOR:".disable-sortable",ENABLED_SORTABLE_SELECTOR:".question-ranking-rank-wrapper:not(.disable-sortable)",HANDLE_SELECTOR:".question-ranking-rank",SORTABLES_CONTAINER_SELECTOR:".question-ranking-sortable-container",HANDLE_WHILE_DRAGGING_CLASS:"question-ranking-rank-dragging",__init:function(){this._$rankContainer=this.$el.find(this.SORTABLES_CONTAINER_SELECTOR);this._buildRankValueMaps();this._initRankState();this._sortRankElements();this._updateEnabledOptions();this.$el.on("mouseenter",this.HANDLE_SELECTOR,{self:this},this._onMouseenter).on("mouseleave",this.HANDLE_SELECTOR,{self:this},this._onMouseleave).on("touchend",this.SORTABLE_SELECTOR,{self:this,event_type:"touch"},this._onMouseUp).on("mousedown",this.ENABLED_SORTABLE_SELECTOR,{self:this,event_type:"mouse"},this._onMousedown).on("touchstart",this.ENABLED_SORTABLE_SELECTOR,{self:this,event_type:"touch"},this._onMousedown).on("change",this.CHECKBOX_SELECTOR,{self:this},this._onNaCheckboxChange).on("change","select",{self:this},this._onSelectChange)},_buildRankValueMaps:function(){var e=this,s={},o={},t=this.$el.find("select").first();t.find("option").each(function(){var e=$(this),t,i=$.trim(e.text()),n;if(i.length){n=parseInt(i,10);if(isNaN(n)){n="na"}t=e.attr("value");s[n]=t;o[t]=n}});this._rankToValue=s;this._valueToRank=o},_initRankState:function(){var r=this,e=this.$el.find(this.SORTABLE_SELECTOR);e.each(function(e,t){var i=$(t),n=i.find("select"),s=i.find(r.CHECKBOX_SELECTOR),o,a;r._syncSelectValue(n);o=n.val();a=o===r._rankToValue.na;s.prop("checked",a);r._updateNAClasses(i,a)})},_sortRankElements:function(){var e=this._buildRankLists(),t=this._sortRankLists(e);this._$rankContainer.append(t)},_buildRankLists:function(){var e=this.$el.find(this.SORTABLE_SELECTOR),a=[],r=[],l=[],u=this;e.each(function(e,t){var i=$(t),n=i.find("select"),s,o;s=n.val();o=s===u._rankToValue.na;i=i.detach();if(o){a.push(i)}else if(s){r.push(i)}else{l.push(i)}});return{naRows:a,rankedRows:r,unrankedRows:l,allRows:e.get()}},_sortRankLists:function(e){var t,s=this;if(!e.rankedRows.length){t=e.unrankedRows}else if(!e.unrankedRows.length){t=e.rankedRows.sort(function(e,t){var i=s._valueToRank[e.find("select").val()],n=s._valueToRank[t.find("select").val()];return i-n})}else{t=s._sortRankedAndUnrankedRows(e)}if(e.naRows.length){t=t.concat(e.naRows)}return t},_sortRankedAndUnrankedRows:function(e){var t=e.allRows.length-e.naRows.length,i,n,s,o=[];for(s=0;s<t;s++){i=s+1;n=this._getRowElByRank(e,i);if(n){o.push(n)}else{o.push(e.unrankedRows.shift())}}return o},_getRowElByRank:function(e,t){var i=e.rankedRows.length,n,s,o;for(o=0;o<i;o++){n=e.rankedRows[o];s=this._valueToRank[n.find("select").val()];if(s===t){return n}}},_onSelectChange:function(e){var a=e.data.self,t=$(this),i=t.parents(a.SORTABLE_SELECTOR),n=i.find(a.CHECKBOX_SELECTOR),s=a.$el.find("select").not(t),o,r,l,u=t.val(),d=a._valueToRank[u],c=t.attr("data-row-id"),h=a._getRankValueEl(c).val(),f=a._valueToRank[h],_=a._rankToValue.na,p=u===_,g=e.cascade,v=$.find("html.auto-scroll").length==1;n.prop("checked",p);a._updateNAClasses(i,p);a._updateEnabledOptions();if(u&&!p){o=a._findOtherSelectWithValue(t);if(o){if(h===_||!h){l=a._getUnnassignedRanks();g="up";$.each(l,function(e){if(e>d){g="down";return false}})}if(a._dragOffset!==undefined){if(g==="down"){r=a._rankToValue[d+1]}else if(g==="up"){r=a._rankToValue[d-1]}else if(f<d){r=a._rankToValue[d-1];g="up"}else if(f>d){r=a._rankToValue[d+1];g="down"}o.val(r).trigger({type:"change",cascade:g})}else{var m=$(o[0]).data("row-label");var b=t.data("question-id");var S=t.data("row-label");var w=$.find("#"+b+"-duplicate-selected");var y="<span role='alert' class='screenreader-only'>Please note, rank "+d+" for "+m+" was unselected</span>";r=a._rankToValue[f];$(w)&&$(w).empty();$(w).append(y);o.val("").trigger("change")}}}else if(p){s.each(function(e,t){var i=$(t),n=i.val(),s,o;if(n&&n!==_){o=a._valueToRank[n];if(f<o){s=a._rankToValue[o-1];i.val(s);a._syncHiddenValue(i)}}else if(n===null){s=a._rankToValue[a._lowestRank];i.val(s);a._syncHiddenValue(i)}})}if(a.__isAllNA()){var C="#"+e.currentTarget.id.split("_")[0]+"-ok";$(C).focus()}if(v){var M=t.closest("div.question-row"),k=M.find("button.new-button");if(k.length>0){k.removeClass("hide")}}a._syncHiddenValue(t)},_onNaCheckboxChange:function(e){var t=e.data.self,i=$(this),n=i.is(":checked"),s=i.parents(t.SORTABLE_SELECTOR),o=s.find("select");if(n){o.val(t._rankToValue.na).trigger("change")}else{t._rankPosition(s)}t._rankPositions()},_onMouseenter:function(e){var t=e.data.self;$(this).addClass(t.HANDLE_HOVER_CLASS)},_onMouseleave:function(e){var t=e.data.self,i=$(this).parent();$(this).removeClass(t.HANDLE_HOVER_CLASS);i.removeClass(t.HANDLE_WHILE_DRAGGING_CLASS)},_getAssignedRanks:function(){var o=this,a={};this.$el.find("select").each(function(e,t){var i=$(t),n=i.val(),s=o._valueToRank[n];if(s&&s!=="na"){a[s]=true}});return a},_getUnnassignedRanks:function(){var t={},i=this,n=this._getAssignedRanks();$.each(this._rankToValue,function(e){if(!n[e]&&e!=="na"&&e<=i._lowestRank){t[e]=true}});return t},__isAllNA:function(){var o=this;var a=true;this.$el.find("select").each(function(e,t){var i=$(t),n=i.val(),s=o._valueToRank[n];if(!s||s&&s!=="na"){a=false}});return a},_findOtherSelectWithValue:function(e){var i=e.val(),n;this.$el.find("select").not(e).each(function(e,t){if($(t).val()===i){n=$(t);return false}});return n},_updateNAClasses:function(e,t){var i=e.find(this.HANDLE_SELECTOR);if(t){i.addClass(this.DISABLED_SORTABLE_HANDLE_CLASS).addClass(this.NA_CLASS);e.addClass(this.DISABLED_SORTABLE_CLASS)}else{i.removeClass(this.DISABLED_SORTABLE_HANDLE_CLASS).removeClass(this.NA_CLASS);e.removeClass(this.DISABLED_SORTABLE_CLASS)}},_updateEnabledOptions:function(){var r=this.$el.find(this.DISABLED_SORTABLE_SELECTOR).length,e,l=this;this.$el.find(this.SORTABLE_SELECTOR).each(function(){var e=$(this),t=e.find("select"),i=e.find(l.CHECKBOX_SELECTOR),n,s=i.prop("checked"),o,a=t.children("option");a.prop("disabled",false);n=-1-r;if(s){n++}a.slice(n,-1).prop("disabled",true)});this._setLowestRank()},_setLowestRank:function(){var s=this,e=this.$el.find(this.ENABLED_SORTABLE_SELECTOR).first(),t,i;i=e.find("option").filter(function(e){var t=$(this),i=t.attr("value"),n=s._valueToRank[i];return!t.prop("disabled")&&n!=="na"}).last();t=this._valueToRank[i.attr("value")];s._lowestRank=t},_syncHiddenValue:function(e){var t=e.attr("data-row-id");this._getRankValueEl(t).val(e.val())},_syncSelectValue:function(e){var t=e.attr("data-row-id");e.val(this._getRankValueEl(t).val())},_getRankValueEl:function(e){return this.$el.find("input[data-row-id="+e+"]")},_onMouseUp:function(e){var t=e.data.self;$(this).removeClass(t.HANDLE_WHILE_DRAGGING_CLASS)},_onMousedown:function(e){var t=e.data.event_type=="touch"?e.originalEvent.touches[0].pageY:e.pageY,i=$(this),n=$(e.target),s=e.data.self,o=t-i.offset().top,a=s.$el.find(s.ENABLED_SORTABLE_SELECTOR);if(n.is("select")||n.is("option")||n.hasClass(s.NA_LABEL_CLASS)||n.parents(s.NA_LABEL_SELECTOR).length){return}s._setupDrag(i,o);e.preventDefault()},_onGlobalMousemove:function(e){var t=e.data.rankingQuestion,i=e.data.$rank,n,s=e.data.event_type=="touch"?e.originalEvent.touches[0].pageY:e.pageY;if(!t._isSorting){t._startSort(i)}n=t._moveRank(i,s);if(n!==undefined&&t._placeholderIndex!==n){t._movePlaceholder(n)}},_onGlobalMouseup:function(e){var t=e.data.rankingQuestion,i=e.data.$rank;if(t._isSorting){t._stopSort(i)}t._teardownDrag()},_setupDrag:function(e,t){this.ondragstart=function(){return false};e.addClass(this.HANDLE_WHILE_DRAGGING_CLASS);document.onselectstart=function(){return false};this.subscribe("mousemove",this._onGlobalMousemove,{$rank:e,event_type:"mouse"}).subscribe("mouseup",this._onGlobalMouseup,{$rank:e,event_type:"mouse"}).subscribe("touchmove",this._onGlobalMousemove,{$rank:e,event_type:"touch"}).subscribe("touchend",this._onGlobalMouseup,{$rank:e,event_type:"touch"});this._dragOffset=t},_startSort:function(e){var t;this._isSorting=true;this._sortRankElements();t=e.clone();t.addClass(this.SORTING_PLACEHOLDER_CLASS);t.insertAfter(e);this._$rankContainer.prepend(e);e.addClass(this.SORTING_CLASS);this._buildRankTops();this._placeholderIndex=t.index();this.trigger("startSort")},_moveRank:function(e,t){var i=this._$rankContainer.offset().top,n=this._$rankContainer.outerHeight(),s=n+i,o=t-this._dragOffset-i,a=e.outerHeight(),r=a+o;if(r>n){e.css("top",n-a)}else if(o<0){e.css("top",0)}else{e.css("top",o)}return this._rankTops[Math.ceil(o)]},_stopSort:function(e){var t=this;this._isSorting=false;e.removeClass(this.SORTING_CLASS);e.css("top","auto");this.$el.find(this.SORTING_PLACEHOLDER_SELECTOR).replaceWith(e);this._rankPosition(e);this._sortRankElements();t._rankPositions();this.trigger("stopSort")},_teardownDrag:function(){this.unsubscribe("mousemove").unsubscribe("mouseup").unsubscribe("touchmove").unsubscribe("touchend");document.onselectstart=null;delete this._dragOffset},_buildRankTops:function(){var e=this.$el.find(this.ENABLED_SORTABLE_SELECTOR),o={};e.each(function(e,t){var i=$(t),n,s=i.position().top;if(e!==0){for(n=s-2;n<=s+2;n++){o[Math.ceil(n)]=e}}});this._rankTops=o},_movePlaceholder:function(e){var t=this._$rankContainer,i=t.children(),n=this._placeholderIndex,s=i.eq(n),o=i.eq(e);if(n<e){o.after(s)}else if(n>e){o.before(s)}this._buildRankTops();this._placeholderIndex=e},_rankPosition:function(e){var t=e.index(),i=t+1,n=this._rankToValue[i],s=e.find("select");s.val(n).trigger("change")},_rankPositions:function(){var a=this,e=this.$el.find(this.SORTABLE_SELECTOR);e.each(function(e,t){var i=$(t),n=i.find("select"),s=n.val(),o=a._rankToValue[e+1];if(s!==a._rankToValue.na){n.val(o);a._syncHiddenValue(n)}})}});SM.SurveyPageForm=SM.Widgets.register({__NAME:"surveyPageForm",__ignoreResize:false,__movingToContainer:false,__init:function(){this._hasAutoScroll=$.find("html.auto-scroll").length==1;this._failedValidation=typeof $("[data-question-validation-message]")[0]!="undefined";var e=$.find("button.new-button");this.$el.on("submit",this._disableSurveySubmitButtons).on("click",".survey-submit-actions button",{self:this},this._onSubmitClick).on("keydown","input, select",{self:this},this._onKeydownAny).on("keydown","input[type=radio]",{self:this},this._onKeydownRadio).on("keyup","input[type=radio]",{self:this},this._onKeyupRadio);$(window).on("unload",{self:this},this._onWindowUnload).on("pagehide",{self:this},this._onWindowUnload).on("load",{self:this},this._onLoad).on("orientationchange resize",{self:this},this._onResize);if($(".question-fileupload").length>0){$(window).on("beforeunload",{self:this},this._onWindowBeforeUnloadFileUpload)}if(this._hasAutoScroll){this.$el.on("click","div.question-click-shield",{self:this},this._onClickShieldClick).on("focus","div.question-row input, div.question-row select,"+"div.question-row textarea, div.question-row .file-upload-btn, div.question-row [role='slider']",{self:this},this._onFocusInput);$(window).on("scroll",{self:this},this._onScroll).on("touchstart",{self:this},this._onTouchStart).on("touchend",{self:this},this._onTouchEnd);$("article.survey-page").data("ignoreScroll",false);if(e.length>0){$(e).on("click",{self:this},this._onOkButtonClick)}}},_onLoad:function(e){var t=e.data.self;t._applyOverflowClasses.apply(t);t._removeNoTouchClasses.apply(t);if(t._hasAutoScroll){var i=$("h3.page-subtitle, .h3.page-subtitle, div.question-row"),n=$("div.question-click-shield"),s=$("article.survey-page");t._resetHeaderMargin();t._resetButtonActionsMargin();t._resetClickShields(false);if(i.length){if($("h3.page-subtitle:not(.overlay), .h3.page-subtitle:not(.overlay), div.question-row:not(.overlay)").length===0){i.first().removeClass("overlay");t._resetPresentationButtons(i.first())}$("div.question-row:not(.overlay)").first().prev("div.question-click-shield").hide()}t._resetProgressBar();s.fadeTo(300,1);if(SM.Cookies.get("instant_response")){SM.SurveyPageForm.switchToNextQuestion($("#question-field-"+SM.Cookies.get("instant_response")));SM.Cookies.remove("instant_response")}}if(t._failedValidation){var o=$("[data-question-validation-message]")[0];var a=$(o)[0].id.split("-")[0];var r=$("input[id*="+a+"], a[id*="+a+"],"+" select[id*="+a+"], textarea[id*="+a+"]")[0];$(r).attr("aria-describedby",o.id);$(r).focus()}if(SM.Touch.isIOSDevice()&&!t._hasAutoScroll&&$(".v3theme-fixed-container").length)$("body").css("overflow","initial")},_onResize:function(e){var t=e.data.self,i=$("h3.page-subtitle, .h3.page-subtitle, div.question-row").not(".overlay").first();if(!t.__ignoreResize){t._applyOverflowClasses.apply(t);if(t._hasAutoScroll){t._resetHeaderMargin();$(window).scrollTop(t._calculateMoveLocation(i));t._resetClickShields(true)}}},_onWindowUnload:function(e){var t=e.data.self;t.set("isSubmitting",false)},_onWindowBeforeUnloadFileUpload:function(e){var t=e.data.self,i=$(".upload-status.sm-spin");if(i.length>0){$(".survey-submit-actions button").removeClass("submitting");t.set("isSubmitting",false)}},_onScroll:function(e){var t=e.data.self,i=$("article.survey-page").data("ignoreScroll");if(i!==true){var n=$("h3.page-subtitle, .h3.page-subtitle, div.question-row"),s=$("div.question-click-shield"),o=0,a=window.innerHeight/2;n.each(function(e,t){if($(t).offset().top-$(window).scrollTop()<=a){o=e}});if($(n.get(o)).hasClass("overlay")){t._resetOverlays();t._resetClickShields(false);t._resetPresentationButtons(n.get(o));$(n.get(o)).removeClass("overlay");if($("h3.page-subtitle, .h3.page-subtitle").length==1&&o>0){$(s.get(o-1)).hide()}else if(!($("h3.page-subtitle, .h3.page-subtitle").length==1&&o===0)){$(s.get(o)).hide()}n.each(function(e,t){if(e==o+1||e==o-1){$(t).trigger("unselect")}});$(n.get(o)).trigger("select");t._resetProgressBar();if(!SM.Touch.isIOSDevice()){$(":focus").blur()}}}},_onKeydownAny:function(e){var t=e.data.self,i=$(this).attr("type"),n=e.which===SM.KeyCodes.ENTER||e.which===SM.KeyCodes.NUMPAD_ENTER;if(n){e.preventDefault();if(i==="radio"||i==="checkbox"){t._toggle(this)}}},_onKeydownRadio:function(e){var t=e.data.self,i=e.which===SM.KeyCodes.SPACE;if(i){e.preventDefault();t._toggle(this)}},_onKeyupRadio:function(e){var t=e.data.self,i=e.which===SM.KeyCodes.SPACE;if(i){e.preventDefault()}},_onSubmitClick:function(e){var t=e.data.self;if(!t.get("isSubmitting")){if($(["data-preset-question"])&&$(":disabled")){$(":disabled").removeAttr("disabled")}}},_onClickShieldClick:function(e){var t=e.data.self,i=$(e.target),n=i.next("div.question-row");if(n.hasClass("overlay")){t._moveToContainer(n)}},_onFocusInput:function(e){var t=e.data.self,i=$(e.target).closest("div.question-row");if(i.hasClass("overlay")){t._moveToContainer(i)}},_onOkButtonClick:function(e){var t=e.data.self,i=$(this);e.preventDefault();e.stopPropagation();i.addClass("hide");SM.SurveyPageForm.switchToNextQuestion(i)},_onTouchStart:function(e){var t=e.data.self;t.__ignoreResize=true},_onTouchEnd:function(e){var t=e.data.self;t.__ignoreResize=false},_applyOverflowClasses:function(){var e=this;e.$el.find(".question-body").each(function(){var e=window.innerWidth<=480?20:50;if(this.scrollWidth>this.offsetWidth+e){$(this).addClass("question-overflow")}})},_removeNoTouchClasses:function(){var e=this;if(SM.Touch.isTouchDevice()){$(e.$el.find(".no-touch")).removeClass("no-touch");$(".survey-language .no-touch").removeClass("no-touch")}},_toggle:function(e){var t=$(e);t.prop("checked",!t.prop("checked")).trigger("change")},_moveToContainer:function(e){var t=this,i=$("h3.page-subtitle, .h3.page-subtitle, div.question-row"),n=$("h3.page-subtitle, .h3.page-subtitle, div.question-row").not(".overlay").first(),s=350;if(n.length==1&&!t.__movingToContainer){var o=n.prev("div.question-click-shield"),a=$(e).prev("div.question-click-shield");n.addClass("overlay");if(o.length){o.show()}$(e).removeClass("overlay");if(a.length){a.hide()}t._resetProgressBar();$("article.survey-page").data("ignoreScroll",true);t._resetPresentationButtons(e);moveToLocation=t._calculateMoveLocation(e);t.__movingToContainer=true;$("html, body").animate({scrollTop:moveToLocation},s,"swing",$.proxy(this._scrollAnimationCallback,t,e))}},_resetPresentationButtons:function(e){$("h3.page-subtitle button.new-button, .h3.page-subtitle button.new-button, div.question-row button.new-button").addClass("hide");if($(e).find("div[data-question-type^=presentation]").length==1||$(e).hasClass("page-subtitle")){button=$(e).find("button.new-button");if($(button).length==1){$(button).removeClass("hide")}}},_resetHeaderMargin:function(){var e=window.innerHeight,t=$("header.survey-page-header").height(),i=$(".sm-progressbar").height(),n=e-i,s=$($("h3.page-subtitle, .h3.page-subtitle, div.question-row")[0]).height(),o=$(".v3theme"),a=$("section.survey-page-body"),r;r=parseInt(s>0?Math.max(10,n/2-s/2-t):0);if(o.length){r=Math.abs(r/2-parseInt(a.css("padding-top")))}a.css("margin-top",r+"px")},_resetButtonActionsMargin:function(){var e=$("div.survey-submit-actions"),t=$("footer.survey-footer.bottom"),i=window.innerHeight/2-e.height()+10;if(i>0){if(t.length==1){t.css("margin-bottom",i+"px")}else{e.css("margin-bottom",i+"px")}if(window.innerHeight<=640){e.css("margin-top",i+"px")}}},_resetClickShields:function(n){var e=$("div.question-click-shield");e.each(function(e,t){if(!n){$(t).show()}var i=$(t).next("div.question-row");if(i.length===1){$(t).height(i.height()).width(i.width())}})},_calculateMoveLocation:function(e){var t=$(e);if(t.length==1){var i=window.innerHeight,n=$(".sm-progressbar").height(),s=t.offset().top-(i-n)/2+t.height()/2;if(s>t.offset().top-10)s=t.offset().top-10;return Math.max(0,s)}else{return 0}},_resetOverlays:function(){$containers=$("h3.page-subtitle, .h3.page-subtitle, div.question-row");$containers.each(function(e,t){if(!$(t).hasClass("overlay")){$(t).addClass("overlay")}})},_resetProgressBar:function(){var e=$("div.question-row:not(:has(div[data-question-type^=presentation]))"),i=parseInt($("div.sm-progress span[data-response-count]").attr("data-response-count")),t=parseInt($("div.sm-progress span[data-question-count]").attr("data-question-count")),n=0;e.each(function(e,t){if($(t).find("input:checked").length>0||$(t).find("select").filter(function(){return!!this.value}).length>0||$(t).find("input[type=tel]").filter(function(){return!!this.value}).length>0||$(t).find("input[type=text]").filter(function(){return!!this.value}).length>0||$(t).find("textarea").filter(function(){return!!this.value}).length>0||$($(t).find("a.file-upload-clear-btn")[0]).is(":visible"))i+=1});$("div.sm-progress span[data-response-count]").html(i);n=i*100/t;$("div.sm-progressbar div.bar div").animate({width:n+"%"},350,"swing");$("div.sm-progressbar div.bar").attr({"aria-valuenow":Math.round(n)})},_scrollAnimationCallback:function(e){var t=this;setTimeout(function(){$("article.survey-page").data("ignoreScroll",false);$(e).trigger("select");t.__movingToContainer=false},200)},switchToNextQuestion:function(e){$(":focus").blur();var t=this,i=$(e).closest("h3.page-subtitle, .h3.page-subtitle, div.question-row"),n=i.nextAll("div.question-row:first"),s=t.isOnScreen($("div.survey-submit-actions"));if(i.is("h3")||i.is(".h3.page-subtitle")){n=$("html").find("div.question-row:first")}if(n.length>0){if(n.hasClass("overlay")){setTimeout(function(){t._moveToContainer(n)},200)}}else{var o=300;t._resetProgressBar();moveToLocation=t._calculateMoveLocation($("div.survey-submit-actions"));$("html, body").animate({scrollTop:moveToLocation},o,"swing")}},isOnScreen:function(e){var t=$(window);var i={top:t.scrollTop(),left:t.scrollLeft()};i.right=i.left+t.width();i.bottom=i.top+t.height();var n=e.offset();n.right=n.left+e.outerWidth();n.bottom=n.top+e.outerHeight();return!(i.right<n.left||i.left>n.right||i.bottom<n.top||i.top>n.bottom)},_disableSurveySubmitButtons:function(){var e=$('form[name="surveyForm"]');if($.validator&&e.valid()||!$.validator){if($("#disable_survey_buttons_on_submit").length){var t=$(".survey-submit-actions button");t.prop("disabled",true);t.addClass("submitting")}}}});SM.Slider=SM.Widgets.register({__NAME:"slider",__init:function(){this._cacheElements()._setLayoutData()._setValues()._bindEvents()},__defaults:{constraints:{min:0,max:100,step:1},value:0,rangeMin:0,rangeMax:100,options:{restrictStepSize:true,animateClick:false}},__setters:{constraints:function(e,t){e._setConstraints(t)},rangeMin:function(e,t){if(!e._isRange){return}e._setRangeMinView(t)._setRangeMin(t)},rangeMax:function(e,t){if(!e._isRange){return}e._setRangeMaxView(t)._setRangeMax(t)},value:function(e,t){if(e._isRange){return}e._setValueView(t)._setValue(t)},restrictStepSize:function(e,t){if(typeof t!=="boolean"){return}e._setStepSizeRestriction(t)}},_setConstraints:function(e){SM.Object.update(this.__settings.constraints,e);this._setLayoutData()._setValues().__trigger("constraintChange");return this},_setValue:function(e){var t=this.__settings,i=t.constraints;e=this._constrainValue(i.min,i.max,e);if(t.value===e){return this}t.value=e;this.__trigger("change");return this},_setRangeMax:function(e){var t=this.__settings,i=t.constraints;e=this._constrainValue(t.rangeMin+i.step,i.max,e);if(t.rangeMax===e){return this}t.rangeMax=e;this.__trigger("change");return this},_setRangeMin:function(e){var t=this.__settings,i=t.constraints;e=this._constrainValue(i.min,t.rangeMax-i.step,e);if(t.rangeMin===e){return this}t.rangeMin=e;this.__trigger("change");return this},_setStepSizeRestriction:function(e){var t=this.__settings,i=t.options.restrictStepSize;if(!i&&e&&!this._stepSizeDividePerfectly()){throw new Error("Cannot restrict the step size of a slider that previously allowed and "+"had a step size that didn't divide max - min")}t.options.restrictStepSize=e;return this},_stepSizeDividePerfectly:function(){var e=this.__settings.constraints,t=e.max-e.min;return t%e.step===0},_setValueView:function(e,t){var i,n=this.__settings,s=n.constraints;e=this._constrainValue(s.min,s.max,e);i=this._valueToHandlePosition(e);if(this._handleLabel){this._$label.text(e)}if(!t){this.__trigger({type:"slide",value:e,$label:this._$label})}else{this.__trigger({type:"start",value:e,$label:this._$label})}if(!n.options.animateClick||!t){this._$handle.css("left",i)}else{this._$handle.stop().animate({left:i},300)}if(this._handleLabel){this._positionLabel(this._$label,this._$handle)}return this},_setRangeMaxView:function(e){var t,i=this.__settings,n=i.constraints;e=this._constrainValue(i.rangeMin+n.step,n.max,e);t=this._valueToHandlePosition(e);this._$maxHandle.css("left",t);if(this._handleLabel){this._$maxLabel.text(e)}this.__trigger({type:"slide",value:e,$label:this._$maxLabel});if(this._handleLabel){this._positionLabel(this._$maxLabel,this._$maxHandle)}this._adjustMaxEnd(t);return this},_setRangeMinView:function(e){var t,i=this.__settings,n=i.constraints;e=this._constrainValue(n.min,i.rangeMax-n.step,e);t=this._valueToHandlePosition(e);this._$minHandle.css("left",t);if(this._handleLabel){this._$minLabel.text(e)}this.__trigger({type:"slide",value:e,$label:this._$minLabel});if(this._handleLabel){this._positionLabel(this._$minLabel,this._$minHandle)}this._adjustMinEnd(t);return this},_cacheElements:function(){this._$handle=this.$el.find("a");if(this._$handle.length>1){this._$minHandle=this._$handle.eq(0);this._$maxHandle=this._$handle.eq(1);this._$range=this.$el.find("div");this._isRange=true}this._$label=this.$el.find("span.slider-label");this._handleLabel=this._$label.length>0;if(this._$label.length>1){this._$minLabel=this._$label.eq(0);this._$maxLabel=this._$label.eq(1)}return this},_setLayoutData:function(){var e=this.__settings.constraints,t;t=e.max-e.min;if(this.__settings.options.restrictStepSize&&!this._stepSizeDividePerfectly()){throw new Error("your min - max must be divisible by your step")}this._width=this.$el.outerWidth();this._stepPixelDistance=this._width/t*e.step;return this},_setValues:function(){var e=this.__settings;if(!this._isRange){this._setValueView(e.value)._setValue(e.value).__trigger("change")}else{this._setRangeMinView(e.rangeMin)._setRangeMin(e.rangeMin)._setRangeMaxView(e.rangeMax)._setRangeMax(e.rangeMax).__trigger("change")}return this},_bindEvents:function(){if(this._isRange){this.$el.on("click",{slider:this},this._onRangeClick);this._$minHandle.on("mousedown",{slider:this,setter:"_setRangeMin"},this._onHandleMouseDown).on("touchstart",{slider:this,setter:"_setRangeMin"},this._onHandleMouseDown).on("keydown",{slider:this,viewSetter:"_setRangeMinView"},this._onHandleKeyDown).on("keyup",{slider:this,setter:"_setRangeMin"},this._onHandleKeyUp).on("click",this._onHandleClick);this._$maxHandle.on("mousedown",{slider:this,setter:"_setRangeMax"},this._onHandleMouseDown).on("touchstart",{slider:this,setter:"_setRangeMax"},this._onHandleMouseDown).on("keydown",{slider:this,viewSetter:"_setRangeMaxView"},this._onHandleKeyDown).on("keyup",{slider:this,setter:"_setRangeMax"},this._onHandleKeyUp).on("click",{slider:this},this._onHandleClick)}else{this.$el.on("click",{slider:this},this._onClick);this._$handle.on("mousedown",{slider:this,setter:"_setValue"},this._onHandleMouseDown).on("touchstart",{slider:this,setter:"_setValue"},this._onHandleMouseDown).on("keydown",{slider:this,viewSetter:"_setValueView"},this._onHandleKeyDown).on("keyup",{slider:this,setter:"_setValue"},this._onHandleKeyUp).on("click",{slider:this},this._onHandleClick)}if(this._handleLabel){$(window).on("resize."+this.__NAME+this.__uid,{slider:this},this._onGlobalResize)}return this},_valueToHandlePosition:function(e){var t=this.__settings.constraints,i=e-t.min,n=Math.round(i/t.step),s=e===t.max?this._width:n*this._stepPixelDistance;return s},_handlePositionToValue:function(e){var t=this.__settings.constraints,i=Math.ceil(this._width/this._stepPixelDistance),n=Math.round(e/this._stepPixelDistance),s=n*t.step,o=s+t.min,a=this._width-this._stepPixelDistance*(i-1),r=e-this._stepPixelDistance*(i-1);if(Math.ceil(e/this._stepPixelDistance)===i&&r>a/2){return t.max}return o},_adjustMinEnd:function(e){this._$range.css("left",e)},_adjustMaxEnd:function(e){this._$range.css("right",this._width-e)},_constrainValue:function(e,t,i){if(i>t){i=t}else if(i<e){i=e}return i},_positionLabel:function(e,t){var i=parseInt(t.css("left"),10),n=t.outerWidth(),s,o=e.outerWidth();if(!e.is(":visible")){o=e.appendTo(document.body).outerWidth();e.appendTo(this.$el)}s=i-(o-n)/2;e.css("left",s);return this},_onClick:function(e){var t=e.data.slider,i=e.pageX-t.$el.offset().left,n=t._handlePositionToValue(i);t._setValueView(n,true);t._setValue(n);t.__trigger("change")},_onRangeClick:function(e){var t=e.data.slider,i=e.pageX-t.$el.offset().left,n=t._handlePositionToValue(i),s=Math.abs(n-t.__settings.rangeMax),o=Math.abs(n-t.__settings.rangeMin);if(s<=o){t._setRangeMaxView(n);t._setRangeMax(n)}else{t._setRangeMinView(n);t._setRangeMin(n)}},_onHandleKeyDown:function(e){var t=$(this),i=e.data.slider,n=i.__settings.constraints,s=e.data.viewSetter,o=e.which,a=i._handlePositionToValue(parseInt(t.css("left"),10));if(!o){return}if(o===SM.KeyCodes.LEFT){i.__trigger("start");i[s](a-n.step)}else if(o===SM.KeyCodes.RIGHT){i.__trigger("start");i[s](a+n.step)}},_onHandleKeyUp:function(e){var t=$(this),i=e.data.slider,n=e.data.setter,s=e.which,o=i._handlePositionToValue(parseInt(t.css("left"),10));if(!s){return}if(s===SM.KeyCodes.LEFT){i[n](o)}else if(s===SM.KeyCodes.RIGHT){i[n](o)}},_onHandleClick:function(e){e.preventDefault()},_onHandleMouseDown:function(e){var t=$(this),i=e.data.setter+"View",n=e.data.slider;this.ondragstart=function(){return false};document.onselectstart=function(){return false};t.focus();n.__trigger("start").__subscribe("touchend",n._onGlobalMouseup,{valueSetter:e.data.setter}).__subscribe("touchmove",n._onGlobalMousemove,{viewSetter:i}).__subscribe("mouseup",n._onGlobalMouseup,{valueSetter:e.data.setter}).__subscribe("mousemove",n._onGlobalMousemove,{viewSetter:i});e.preventDefault()},_onGlobalMouseup:function(e){var t=e.data.slider,i=e.type==="touchend"?parseInt($(e.target).css("left").replace("px",""),10):e.pageX,n=e.type==="touchend"?i:i-t.$el.offset().left,s=e.data.valueSetter,o=t._handlePositionToValue(n);t.__unsubscribe("touchmove").__unsubscribe("touchend").__unsubscribe("mousemove").__unsubscribe("mouseup");document.onselectstart=null;t[s](o,true);t.__trigger("stop")},_onGlobalMousemove:function(e){var t=e.data.slider,i=e.data.viewSetter,n=e.type==="touchmove"?e.originalEvent.touches[0].pageX:e.pageX,s=n-t.$el.offset().left,o=t._handlePositionToValue(s);t[i](o)},_onGlobalResize:function(e){var t=e.data.slider;if(t._isRange){t._positionLabel(t._$minLabel,t._$minHandle);t._positionLabel(t._$maxLabel,t._$maxHandle)}else{t._positionLabel(t._$label,t._$handle)}}});SM.EmojiRatingQuestion=SM.Widgets.register({__NAME:"emojiRatingQuestion",__init:function(){var e=this;this._radioMouseClicked=false;this.$el.on("change","input[type=radio]",{self:this},this._onChange).on("click",".emoji-rating",{self:this},this._onClick).on("mouseenter",".emoji-color, .emoji-border",{self:this},this._onMouseEnter).on("mouseleave",".emoji-color, .emoji-border",{self:this},this._onMouseLeave).on("mouseup","input[type=radio]",{self:this},this._onMouseUp).on("focusin","input[type=radio]",{self:this},this._onFocusin).on("focusout","input[type=radio]",{self:this},this._onFocusout);this._refreshEmojiState()},_onMouseEnter:function(e){var t=e.data.self,i=t.$el.closest(".question-emoji-rating-table"),n=t.$el.find(".emoji-rating"),s=i.find(".emoji-rating");s.each(function(e,t){$(t).addClass("selected");$(t).find(".emoji-border").addClass("hovered");if(n.is($(t)))return false})},_onMouseLeave:function(e){var t=e.data.self,i=t.$el.closest(".question-emoji-rating-table"),n=t.$el.find(".emoji-rating"),s=i.find("[data-sm-emoji-button]");s.each(function(e,t){var i=$(t).find("input:checked");if(i.length!=1){$(t).find(".emoji-rating").removeClass("selected");$(t).find(".emoji-border").removeClass("hovered")}if(n.is($(t)))return false});t._refreshEmojiState()},_onMouseUp:function(e){var t=e.data.self,i=t.$el.closest("[data-sm-emoji-button]"),n=i.find(".emoji-border");n.removeClass("focus");t._radioMouseClicked=true},_onFocusin:function(e){var t=e.data.self,i=t.$el.closest("[data-sm-emoji-button]"),n=i.find(".emoji-border");n.addClass("focus")},_onFocusout:function(e){var t=e.data.self,i=t.$el.closest("[data-sm-emoji-button]"),n=i.find(".emoji-border");n.removeClass("focus")},_onChange:function(e){var t=e.data.self;t._radioMouseClicked=false;t._refreshEmojiState()},_onClick:function(e){var t=e.data.self,i=t.$el.find("input[type=radio]");if(!$(e.target).is(i)){i.prop("checked",!i.prop("checked"));i.trigger("change")}else if(t._radioMouseClicked&&i.data("selected")){i.prop("checked",false);i.trigger("change")}},_refreshEmojiState:function(){var e=this,t=e.$el.closest(".question-emoji-rating-table"),i=t.find("[data-sm-emoji-button]"),n=i.find("input:checked");i.find(".emoji-rating").removeClass("selected");i.find(".emoji-border").removeClass("hovered");i.find("input[type=radio]").data("selected",false);if(n.length==1){i.each(function(e,t){$(t).find(".emoji-rating").addClass("selected");var i=$(t).find("input:checked");if(i.length==1){if(!i.data("selected"))i.data("selected",true);return false}})}}});SM.OpenEnded=SM.Widgets.register({__NAME:"openEnded",__init:function(){this._hasAutoScroll=$.find("html.auto-scroll").length==1;this.$el.on("input",{self:this},this._onTextChange);$(window).on("load positionCurrencySymbol",{self:this,delay:0},this._positionCurrencySymbol);$(window).on("orientationchange resize",{self:this,delay:400},this._positionCurrencySymbol)},_onTextChange:function(e){var t=e.data.self,i=$(e.target),n=i.closest("div.question-row").find("button.new-button");SM.ResponseQuality._updateOpenEnded(i,e.originalEvent.inputType);if(t._hasAutoScroll&&i.val().length>0){$(n).removeClass("hide")}},_positionCurrencySymbol:function(e){var t=e.data.self,i=e.data.delay,n=$(t.el),s=n.closest("div.question-body").find(".payment-currency-symbol");if(s.length===1){setTimeout(function(){s.css("padding-left",n.offset().left-s.offset().left+parseInt(n.css("padding-right"))+"px");s.css("padding-top",parseInt(n.css("padding-top"))+parseInt(n.css("margin-top"))-1+"px");n.css("padding-left",s.width()+10+"px")},i)}}});SM.Date={getDaysInMonth:function(e,t){return 32-new Date(t,e,32).getDate()},getSimpleDate:function(e){if(!e){return{}}return{month:e.getMonth(),year:e.getFullYear(),day:e.getDate()}},timestamp:function(){return(new Date).getTime()},toISOString:function(e){var t=function(e){return e<10?"0"+e:e};if(!Date.prototype.toISOString){return[this.getUTCFullYear(),"-",t(this.getUTCMonth()+1),"-",t(this.getUTCDate()),"T",t(this.getUTCHours()),":",t(this.getUTCMinutes()),":",t(this.getUTCSeconds()),"Z"].join("")}return e.toISOString()},stdTimezoneOffset:function(){var e=new Date,t=e.getFullYear(),i=new Date(t,0,1),n=new Date(t,6,1);return Math.max(i.getTimezoneOffset(),n.getTimezoneOffset())},utcOffset:function(){return(new Date).getTimezoneOffset()*-6e4},toAge:function(e){var t,i,n,s,o,a,r,l;o=Math.floor(e/1e3);t=o%60;a=Math.floor(o/60);i=a%60;r=Math.floor(a/60);n=r%24;l=Math.floor(r/24);s=l%365;return{seconds:t,minutes:i,hours:n,days:s}},ageToMilliseconds:function(e){var t=e.split(" "),i=0,n,s,o,a=0;for(;i<t.length;i++){n=t[i];s=parseInt(n,10);o=n.charAt(n.length-1);o=this._millisecondMap[o];if(o){a+=s*o}}return a},formatDigitalTime:function(e,t,i){var n="";n=this._addDigitalTimeString(n,e)+":";n=this._addDigitalTimeString(n,t)+":";return this._addDigitalTimeString(n,i)},_millisecondMap:{s:1e3,m:1e3*60,h:1e3*60*60,d:1e3*60*60*24,o:1e3*60*60*24*30,y:1e3*60*60*24*365},_addDigitalTimeString:function(e,t){if(t>9){e=e+t}else if(t>0){e=e+"0"+t}else{e=e+"00"}return e}};SM.Cookies={get:function(e){var t=this.getAll();return t[e]},set:function(e,t,i,n){var s,o;n=SM.Object.extend({path:"/"},n);if(typeof i==="string"){o=SM.Date.ageToMilliseconds(i)}else{o=i}s=new Date;s.setTime(s.getTime()+o);i=s.toGMTString();document.cookie=[e+"="+t,"expires="+i,"path="+n.path].join("; ");return this},remove:function(e,t){t=SM.Object.extend({path:"/"},t);return this.set(e,"","-1s",t)},getAll:function(){var i={},n,e=document.cookie.split(";");$.each(e,function(e,t){t=$.trim(t);n=t.split("=");if(n.length===2){i[n[0]]=n[1]}});return i}};$(function(){if(!SM.Touch.isTouchDevice()){$(".image-choice-label").addClass("image-choice-label-hover")}if(SM.Touch.isTouchDevice()||!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)){$(".radio-button-label.image-choice-label").attr("tabindex","0")}});$(function(){function e(){var e=$(".survey-language-menu"),t=$(".survey-language-container");if(e.width()>t.width()){t.width(e.width())}}function o(){var e=$(".survey-language-menu");e.css("display","none")}function t(){var e=$(".survey-language-menu");e.css("display","block");e.focus()}function n(){var i=$(".survey-language-menu"),e=$("body");if(i.css("display")==="none"){t();e.on("touchstart",function(e){var t=$(e.target);if(!t.hasClass("survey-language-menu")&&!t.hasClass("survey-language-option")&&!t.hasClass("survey-language-toggle")){n();i.off("blur")}})}else{o();e.off("touchstart")}}function i(){var e=$(this),t=$('form[name="surveyForm"]'),i=$(".survey-language-toggle"),n=$("input#is_changing_language",t),s=$(".survey-language-menu");if(!e.hasClass("selected")){i.text(e.text());t.attr("action",e.attr("value"));n.val("true");o();t.submit()}else{o()}}$(".survey-language-toggle").on("click ",n);$(".survey-language-menu").on("blur",o);$(".survey-language-option").on("click",i);$(window).on("load",e)});SM.FacebokShareButton=SM.Widgets.register({__NAME:"fbShareBtn",__init:function(){this.$el.on("click",{self:this},this._onClick)},_onClick:function(e){e.preventDefault();var t=e.data.self;t._fbShareBtn(t.$el.attr("data-facebook-app-id"),"",t.$el.attr("data-survey-title"),t.$el.attr("data-redirect-url"))},_getQueryVariable:function(e){var t=window.location.search.substring(1);var i=t.split("&");for(var n=0;n<i.length;n++){var s=i[n].split("=");if(decodeURIComponent(s[0])===e){return decodeURIComponent(s[1])}}},_fbShareBtn:function(e,t,i,n){var s="http://www.facebook.com/dialog/feed?app_id="+e+"&show_error=true&",o=this._getQueryVariable("na")==="new_auth"?"user/auth/":"closepop.aspx";if(t===""){s+="link="+encodeURI(location.href)+"&"}else{s+="link="+encodeURI("http://facebook.com/pages/SM-Survey-View/"+t+"?sk=app_"+e)+"&";s+="caption= &"}s+="name="+i+"&";s+="description="+window.escape('Please take the survey titled "'+i+'". Your feedback is important!')+"&";s+="picture="+$('link[rel="image_src"]').attr("href")+"&";s+="redirect_uri=http://"+n+"/"+o+"?close=true";var a=window.open(s,"_blank","width=700,height=580,scrollbars=yes");a.focus()}});SM.ResponseQuality=SM.Widgets.register({__NAME:"responseQuality",__rq_dict:{},__supported_types:["dropdown","dropdown_matrix","single_choice_horiz","multiple_choice_horiz","single_choice_matrix","multiple_choice_matrix","emoji","net_promoter_score","single_choice_vertical","multiple_choice_vertical","single_choice_vertical_two_col","multiple_choice_vertical_two_col","single_choice_vertical_three_col","multiple_choice_vertical_three_col","single_image_choice","multiple_image_choice"],__init:function(){$(window).on("load",function(){var e=SM.ResponseQuality.__rq_dict;e["start_time"]=(new Date).getTime();if("end_time"in e){e["time_spent"]=e["end_time"]-e["start_time"]}});$("[data-submit-page-button]").on("click",function(){var e=SM.ResponseQuality.__rq_dict;e["end_time"]=(new Date).getTime();if("start_time"in e){e["time_spent"]=e["end_time"]-e["start_time"]}e["previous_clicked"]=false;e["has_backtracked"]=false;$("#response_quality_data").val(JSON.stringify(e))});$("[data-previous-page-button]").on("click",function(){var e=SM.ResponseQuality.__rq_dict;e["end_time"]=(new Date).getTime();if("start_time"in e){e["time_spent"]=e["end_time"]-e["start_time"]}e["previous_clicked"]=true;e["has_backtracked"]=true;$("#response_quality_data").val(JSON.stringify(e))});SM.ResponseQuality.__rq_dict["question_info"]={};$(document).find("[data-rq-question-type]").each(function(e,t){SM.ResponseQuality._initQuestion(e,t)})},_initQuestion:function(e,t){var i=$(t),n="qid_".concat(i.children("[id|=question-field]").attr("data-question-id")),s=i.children("[id|=question-field]").attr("data-qdispnumber"),o=i.attr("data-rq-question-type"),a=i.find("[class*=other-answer-container]").length,r=a>0,l=a===1&&i.find("[data-other-answer]").length>0,u=l?false:null;var d=null,c=null,h=null,f=null,_,p,g=r&&u!==null;if(this.__supported_types.indexOf(o)!==-1){d=Math.max(i.find("[type!=text]:input").length,i.find("option").length);h=this._calculateDimensions(i,o,d);if(o.indexOf("dropdown")!==-1){p=this._initDropdown(i,o,g);c=p[0];u=p[1]}else if(o.indexOf("single")!==-1||o==="emoji"||o==="net_promoter_score"){p=this._initSingleChoice(i,o,g,d);c=p[0];u=p[1]}else if(o.indexOf("multiple")!==-1){p=this._initMultipleChoice(i,o,g,d);c=p[0];u=p[1]}}_={number:s?parseInt(s):-1,type:o,option_count:d,has_other:r,other_selected:u,relative_position:c,dimensions:h,input_method:f};this.__rq_dict["question_info"][n]=_},_initDropdown:function(e,t,i){var s=[],n=null,o;if(t==="dropdown"){o=e.find("select").prop("selectedIndex");if(o!==0)s=[[o,0]]}else if(t==="dropdown_matrix"){e.find("select").each(function(e,t){var i=$(t),n=i.prop("selectedIndex");if(n!==0){s.push([parseInt(i.parents("[row]").attr("row")),parseInt(i.parents("[col]").attr("col")),n])}})}if(i){var a=e.find("select").children(":eq("+o+")").attr("data-other-answer");n=typeof a!==typeof undefined}return[s,n]},_initSingleChoice:function(e,i,t,n){var s=this,o=[],a=null,r=-1,l,u,d;if(i==="single_choice_matrix"){e.find("input[type=radio]").each(function(e,t){l=$(t);if(l.attr("checked")==="checked"){u=parseInt(l.parents("[row]").attr("row"));d=parseInt(l.parents("[col]").attr("col"));o.push([u,d])}})}else{e.find("input[type=radio]").each(function(e,t){l=$(t);if(l.attr("checked")==="checked"){r=e;o=[s._relativePositionNonMatrix(r,i,n)];return false}})}if(t){a=this._otherSelected(e)}return[o,a]},_initMultipleChoice:function(e,i,t,n){var s=this,o=[],a=null,r,l,u;if(i==="multiple_choice_matrix"){e.find("input[type=checkbox]").each(function(e,t){r=$(t);if(r.attr("checked")==="checked"){l=parseInt(r.parents("[row]").attr("row"));u=parseInt(r.parents("[col]").attr("col"));o.push([l,u])}})}else{e.find("input[type=checkbox]").each(function(e,t){r=$(t);if(r.attr("checked")==="checked"){o.push(s._relativePositionNonMatrix(e,i,n))}})}if(t){a=this._otherSelected(e)}return[o,a]},_calculateDimensions:function(e,t,i){var n,s,o;if(["single_choice_horiz","multiple_choice_horiz","emoji","net_promoter_score"].indexOf(t)!==-1){return[1,i]}else if(["single_choice_vertical","multiple_choice_vertical","dropdown"].indexOf(t)!==-1){return[i,1]}else if(["single_choice_vertical_two_col","multiple_choice_vertical_two_col"].indexOf(t)!==-1){return[Math.ceil(i/2),2]}else if(["single_choice_vertical_three_col","multiple_choice_vertical_three_col"].indexOf(t)!==-1){return[Math.ceil(i/3),3]}else if(["single_image_choice","multiple_image_choice"].indexOf(t)!==-1){return[Math.ceil(i/3),3]}else if(["single_choice_matrix","multiple_choice_matrix"].indexOf(t)!==-1){n=e.find("[row]").length;s=e.find("[col]").length/n;return[n,s]}else if(["dropdown_matrix"].indexOf(t)!==-1){n=e.find("[row]").length;s=e.find("[col]").length/n;o=0;e.find("[row=0]").find("[col]").each(function(e,t){var i=$(t).find("option").length;if(i>o){o=i}});return[n,s,o]}else{return[-1,-1]}},_updateQuestion:function(e,t,i){var n="qid_".concat(e);if(["question_info"]in this.__rq_dict&&n in this.__rq_dict["question_info"]){var s=this.__rq_dict["question_info"][n];var o=s["type"];if(o===null||o===undefined){o=""}if(o.indexOf("single")!==-1||["emoji","net_promoter_score"].indexOf(s["type"])!==-1){this._updateSingleChoice(s,t,i)}else if(o.indexOf("multiple")!==-1){this._updateMultipleChoice(s,t,i)}else if(o.indexOf("dropdown")!==-1){this._updateDropdown(s,t,i)}else{s["relative_position"]=[[-1]]}}},_updateSingleChoice:function(e,t,i){var n,s,o,a=i["checked"],r=i["question"].$el;if(e["type"]==="single_choice_matrix"){s=parseInt(i["row"]);o=parseInt(i["col"]);n=[s,o];for(var l=0;l<e["relative_position"].length;l++){if(e["relative_position"][l][0]===s){break}}if(a){if(l!==e["relative_position"].length){e["relative_position"][l]=n}else{e["relative_position"].push(n)}}else{e["relative_position"].splice(l,1)}}else{if(a){n=this._relativePositionNonMatrix(t,e["type"],e["option_count"]);e["relative_position"]=[n]}else{e["relative_position"]=[]}}if(e["has_other"]&&e["other_selected"]!==null){e["other_selected"]=this._otherSelected(r)}},_updateMultipleChoice:function(e,t,i){var n,s,o,a=i["checked"],r=i["question"].$el.parents("[id|=question-field]");if(e["type"]==="multiple_choice_matrix"){s=parseInt(i["row"]);o=parseInt(i["col"]);n=[s,o]}else{n=this._relativePositionNonMatrix(t,e["type"],e["option_count"])}if(a){e["relative_position"].push(n)}else{for(var l=0;l<e["relative_position"].length;l++){if(e["relative_position"][l][0]===n[0]&&e["relative_position"][l][1]===n[1]){break}}if(l!==e["relative_position"].length){e["relative_position"].splice(l,1)}}if(e["has_other"]&&e["other_selected"]!==null){e["other_selected"]=this._otherSelected(r)}},_otherSelected:function(e){var t=e.find("[class*=other-answer-container]"),i=false;t.find("input").each(function(e,t){i=i||t.checked;if(i){return false}});return i},_updateDropdown:function(e,t,i){var n=i["question"];if(e["type"]==="dropdown"){e["relative_position"]=[[t,0]]}else if(e["type"]==="dropdown_matrix"){var s=parseInt(i["row"]),o=parseInt(i["col"]),a=[s,o,t];for(var r=0;r<e["relative_position"].length;r++){if(e["relative_position"][r][0]===a[0]&&e["relative_position"][r][1]===a[1]){break}}if(r!==e["relative_position"].length){e["relative_position"][r]=a}else{e["relative_position"].push(a)}}else{e["relative_position"]=[[-1]]}if(e["has_other"]&&e["other_selected"]!==null){var l=n.children(":eq("+t+")").attr("data-other-answer"),u=typeof l!==typeof undefined;e["other_selected"]=u}},_updateOpenEnded:function(e,t){if(e.parents("[data-rq-question-type]").attr("data-rq-question-type")==="open_ended"){var i="qid_".concat(e.attr("id")),n=this.__rq_dict["question_info"][i];if(n["type"]==="open_ended"){if(t==="insertFromPaste"){n["input_method"]="text_pasted"}else if(t==="insertText"){n["input_method"]="text_typed"}}}},_relativePositionNonMatrix:function(e,t,i){var n=[],s;if(["single_choice_horiz","emoji","net_promoter_score","multiple_choice_horiz"].indexOf(t)!==-1){n=[0,e]}else if(["single_choice_vertical","multiple_choice_vertical"].indexOf(t)!==-1){n=[e,0]}else if(["single_choice_vertical_two_col","multiple_choice_vertical_two_col"].indexOf(t)!==-1){s=Math.ceil(i/2);n=[e%s,Math.floor(e/s)]}else if(["single_choice_vertical_three_col","multiple_choice_vertical_three_col"].indexOf(t)!==-1){s=Math.ceil(i/3);n=[e%s,Math.floor(e/s)]}else if(["single_image_choice","multiple_image_choice"].indexOf(t)!==-1){n=[Math.floor(e/3),e%3]}else{n=[e]}return n}});$(function(){var e="survey_file_uploader",t=$("[data-question-fileupload]"),i=$("[data-date-picker]"),n=$.find("article.auto-scroll").length==1,s=$("#survey-language-selector");function o(){var e=$("body"),t=$("#hcmtest"),i,n;if(t.length==1){n=t.css("background-color");if(n){i=n.toLowerCase()}t.remove();if(i&&i!=="#878787"&&i!=="rgb(135, 135, 135)"){e.addClass("is-high-contrast");$(".btn").removeClass("btn")}}}$("[data-survey-page-form]").surveyPageForm();$("[data-previous-page-button]").on("click",function(e){$("#is_previous").val(true)});$("[data-other-text]").otherAnswerTextOption();$("[data-forced-ranking]").forcedRankingQuestion();$("[data-nps]").npsQuestion();$("[data-question-ranking]").rankingQuestion();$('[data-exit-survey-btn][href="#"]').on("click",function(e){window.close()});$("[data-radio-button-group]").radioButtonGroup();$("[data-sm-checkbox]").checkbox();$("[data-sm-select]").dropdown();$("[data-sm-emoji-button]").emojiRatingQuestion();$("[data-question-slider]").sliderQuestion();$("[data-sm-textarea]").openEnded();$("[data-sm-open-single]").openEnded();$("[data-other-text]").openEnded();$("[data-datetime-text]").openEnded();$("[data-response-quality]").responseQuality();var a=window.navigator.userAgent.match(/(MSIE|Trident)/);if(a){$("#patas").addClass("ie")}if(t.length){t.fileUploadQuestion({uploaderConfig:__UPLOADER,uploadAreaTemplateId:e})}if(i.length){$("[data-date-picker]").datePicker()}if(typeof $("[data-question-validation-message]")[0]!="undefined"&&!n){$("[data-question-validation-message]").first().focus();$("[data-question-validation-message]")[0].scrollIntoView()}$("#fb_share_btn").fbShareBtn();o();if(SM.Touch.isTouchDevice()){SM.Touch.init(document.body)}function r(){$("div.radio-button-container").on("click",function(e){var t=JSON.stringify({eventName:"sm:answer_clicked",element:$(e.target).closest("label").attr("for"),selected_state:!$(this).find("input.radio-button-input").prop("checked")});l(t)});$("div.checkbox-button-container").on("click",function(e){var t=JSON.stringify({eventName:"sm:multi_answer_clicked",element:$(e.target).closest("label").attr("for"),selected_state:!$(this).find("input.checkbox-button-input").prop("checked")});l(t)});$(".question-body select.select").on("change",function(e){var t=JSON.stringify({eventName:"sm:dropdown_answer_selected",element:$(this).closest("select").attr("id"),choice_val:$(this).find(":selected").val()});l(t)});$("div[data-question-id]").on("click",function(e){var t=JSON.stringify({eventName:"sm:question_clicked",element:$(this).attr("data-question-id")});l(t)});$(".survey-page-body").on("ready",function(e){var t=JSON.stringify({eventName:"sm:page_loaded",element:$(this).find("div[data-question-id]:first").attr("data-question-id"),page_id:$("article.survey-page").attr("data-page-id")});l(t)});$(".next-button").on("click",function(e){var t=JSON.stringify({eventName:"sm:page_next_clicked",element:$("article.survey-page").attr("data-page-id"),openEndedResponses:u()});l(t)});$(".prev-button").on("click",function(e){var t=JSON.stringify({eventName:"sm:page_prev_clicked",element:$("article.survey-page").attr("data-page-id")});l(t)});message=JSON.stringify({eventName:"sm:page_loaded",element:$("div[data-question-id]:first").attr("data-question-id")});l(message);$("div.question-click-shield").on("hide",function(e,t){var i=JSON.stringify({eventName:"sm:page_loaded",element:$(this).next("div.question-row").find("div[data-question-id]").attr("data-question-id")});l(i)});$("div.emoji-rating").on("click",function(e){setTimeout(function(){var e=JSON.stringify({eventName:"sm:answer_clicked",element:$(this).find("input.emoji-button-input").attr("id"),selected_state:$(this).find("input.emoji-button-input").prop("checked")});l(e)}.bind(this),0)});$("input.other-answer-text").on("focus",function(e){setTimeout(function(){var e=JSON.stringify({eventName:"sm:answer_clicked",element:$(this).parent("div.other-answer-container").find("input[data-other-answer]").attr("id"),selected_state:$(this).parent("div.other-answer-container").find("input[data-other-answer]").prop("checked")});l(e)}.bind(this),0)})}function l(e){if(window.opener||window.parent){window.parent.postMessage(e,"*")}}function u(){var i={},e=$('input[type="text"], input[type="tel"], textarea'),n,s,o,a;$.each(e,function(e,t){a=$(t);o=a.attr("id").split("_");if(a.attr("id").indexOf("-")!==-1){o=a.attr("id").split("-")}n=o[0];if(typeof i[n]==="undefined"){i[n]={}}if(o.length==2){s=o[1];if(s==="alternative"){s=n}if(typeof i[n].answers==="undefined"){i[n].answers={}}i[n].answers[s]=a.val()}else{i[n].answer=a.val()}});return i}if($("input#is_preview").length>0){r()}var d=["sm_spage_hide_preview_warning","sm_spage_commenting_tour_review","sm_spage_commenting_tour_owner","sm_spage_commenting_tour_commenting_turned_off","logged_in_fetch_request_domain"],c=document.cookie,h=new Date;h.setDate(h.getDate()-1);for(var f=0;f<d.length;f++){if(c.indexOf(d[f])>=0){document.cookie=d[f]+"=; expires="+h.toGMTString()+"; path=/"}}});